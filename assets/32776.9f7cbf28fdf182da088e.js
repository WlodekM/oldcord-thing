"use strict";(this.webpackChunkdiscord_app=this.webpackChunkdiscord_app||[]).push([["32776"],{975608:function(n,e,t){t(411104);var l=t(470079),u=t(960048);e.Z=(n,e,t,i,r)=>{let a=(0,l.useRef)(!1);(0,l.useEffect)(()=>{if(e&&!a.current){a.current=!0;let e=setTimeout(()=>{let e=Error("".concat(n," is taking too long to load."));u.Z.setExtra({loadingState:i,loadingTimeSeconds:t}),u.Z.captureException(e,{...r,tags:{...null==r?void 0:r.tags}})},1e3*t);return()=>{clearTimeout(e)}}},[e,t])}},382577:function(n,e,t){t.d(e,{Z:function(){return i}});var l=t(470079),u=t(570140);function i(n){let e=(0,l.useRef)(n);(0,l.useEffect)(()=>{e.current=n},[n]),(0,l.useEffect)(()=>{if(__OVERLAY__){function n(n){n.locked&&e.current()}return u.Z.subscribe("OVERLAY_SET_INPUT_LOCKED",n),()=>{u.Z.unsubscribe("OVERLAY_SET_INPUT_LOCKED",n)}}},[])}},791785:function(n,e,t){t.r(e),t.d(e,{PaymentModal:function(){return w},PaymentPredicateStep:function(){return b}}),t(47120);var l=t(735250),u=t(470079),i=t(120356),r=t.n(i),a=t(792986),o=t(399606),s=t(481060),c=t(496929),d=t(975608),_=t(89057),E=t(382577),f=t(439017),p=t(104494),m=t(176919),T=t(711007),M=t(459965),I=t(509545),A=t(580130),v=t(626135),S=t(669079),h=t(74538),N=t(987209),P=t(598),R=t(409813),y=t(45572),g=t(784707),C=t(614223),L=t(48175),Z=t(928886),k=t(456251),O=t(614277),x=t(981631),U=t(474936),D=t(689938),G=t(508049);function w(n){let{analyticsLocations:e,analyticsLocation:t,analyticsObject:i,analyticsSourceLocation:o,analyticsSubscriptionType:c=x.NYc.PREMIUM,onComplete:d,transitionState:_,initialPlanId:f,subscriptionTier:A,onClose:C,trialId:L,trialFooterMessageOverride:k,reviewWarningMessage:w,planGroup:b=U.Y1,openInvoiceId:Y,onSubscriptionConfirmation:H,renderPurchaseConfirmation:W,postSuccessGuild:j,followupSKUInfo:K,renderHeader:B,applicationId:F,guildId:V,referralTrialOfferId:X,skuId:z,onStepChange:Q,shakeWhilePurchasing:q=!1,isLargeModal:J=!1,hideShadow:$=!1,returnRef:nn,skipConfirm:ne=!1,continueSession:nt=!1}=n,{activitySessionId:nl,purchaseState:nu,setPurchaseState:ni,selectedSkuId:nr,setSelectedSkuId:na,selectedPlan:no,setSelectedPlanId:ns,setStep:nc,setPurchaseError:nd,paymentAuthenticationState:n_,step:nE,contextMetadata:nf,purchaseTokenAuthState:np,activeSubscription:nm,priceOptions:nT,hasPaymentSources:nM,paymentSourceId:nI,paymentSources:nA,purchaseType:nv,defaultPlanId:nS}=(0,P.usePaymentContext)(),nh=(0,g.Z)(),nN=J||(null==nh?void 0:nh.isLargeModal)?s.ModalSize.LARGE:s.ModalSize.SMALL,{isGift:nP,giftRecipient:nR,customGiftMessage:ny,emojiConfetti:ng,soundEffect:nC}=(0,N.wD)(),nL=(0,p.Ng)(),nZ=null!=A&&!nP&&(0,p.Wp)(nL,A),[nk,nO]=u.useState({load_id:nf.loadId,payment_type:x.Zuq[nv],location:null!=t?t:i,source:o,subscription_type:c,subscription_plan_id:null==no?void 0:no.id,is_gift:nP,eligible_for_trial:null!=L,location_stack:e,sku_id:z,application_id:F,guild_id:V,payment_modal_version:"v1",activity_session_id:nl,eligible_for_discount:nZ}),nx=null!=nI?nA[nI]:null;u.useEffect(()=>{nO(n=>{let e=null!=no?(0,h.aS)(no.id,!1,nP,nT):void 0;return{...n,subscription_plan_id:null==no?void 0:no.id,price:null==e?void 0:e.amount,regular_price:null==no?void 0:no.price,currency:nT.currency,sku_id:nr}})},[no,nr,nP,nT]),u.useEffect(()=>{v.default.track(x.rMx.PAYMENT_FLOW_STARTED,{...nk,has_saved_payment_source:nM})},[]),u.useEffect(()=>{if(null!=nS&&nt?ns(nS):ns(f),null!=z)na(z);else if(null!=f){var n;na(null===(n=I.Z.get(f))||void 0===n?void 0:n.skuId)}},[ns,na,f,z,nS,nt]);let nU=u.useCallback(()=>{let n=(0,S.MY)(nR)===S.xr.CUSTOM_MESSAGE_EMOJI_SOUNDBOARD,e=Date.now();v.default.track(x.rMx.PAYMENT_FLOW_SUCCEEDED,{...nk,is_custom_message_edited:nP&&n&&null!=ny?ny!==D.Z.Messages.DEFAULT_CUSTOM_GIFT_MESSAGE:void 0,is_custom_emoji_sound_available:nP&&n,emoji_name:nP&&n&&(null==ng?void 0:ng.id)==null?null==ng?void 0:ng.surrogates:void 0,sound_id:nP&&n?null==nC?void 0:nC.soundId:void 0,duration_ms:e-nf.startTime,payment_source_type:null==nx?void 0:nx.type})},[nk,ng,ny,nR,nP,nC,nf.startTime,nx]),nD=u.useMemo(()=>()=>null==C?void 0:C(nu===y.A.COMPLETED,nr),[C,nu,nr]),nG=(0,a.Z)(()=>Date.now(),[nE]),nw=u.useCallback(function(n){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{trackedFromStep:t,analyticsDataOverride:l,fulfillment:u}=e,i=Date.now();if(n===R.h8.CONFIRM&&(nU(),null==d||d(u),ne)){nD();return}nc(n),null==Q||Q(n),nd(null);let r=null!=t?t:nE;if(null===r){v.default.track(x.rMx.PAYMENT_FLOW_LOADED,{...nk,initial_step:n,has_saved_payment_source:nM});return}v.default.track(x.rMx.PAYMENT_FLOW_STEP,{...nk,...l,from_step:r,to_step:n===R.h8.ADD_PAYMENT_STEPS?R.h8.PAYMENT_TYPE:n,step_duration_ms:i-nG,flow_duration_ms:i-nf.startTime})},[nc,Q,nd,nE,nk,nG,nf.startTime,nU,d,ne,nD,nM]);(0,m.bp)(nE,n_,nw),(0,R.dZ)(nE,nu,ni),(0,T.p)(nE,np,nw),(0,E.Z)(nD),(0,M.w)(nm,()=>C(!1),nP),(0,m.D6)(n_);let nb=(0,Z.U)({renderHeader:B,referralTrialOfferId:X,handleClose:nD});return(0,l.jsx)(s.Shaker,{className:G.shaker,isShaking:q&&nu===y.A.PURCHASING,intensity:2,children:(0,l.jsx)(s.ModalRoot,{className:r()(G.root,{[G.withHeader]:null!=nb}),transitionState:_,hideShadow:$,returnRef:nn,size:nN,children:(0,l.jsx)(O.ZP,{header:nb,isLargeModal:J||(null==nh?void 0:nh.isLargeModal),initialPlanId:f,subscriptionTier:A,handleStepChange:nw,handleClose:nD,analyticsData:nk,setAnalyticsData:nO,trialId:L,trialFooterMessageOverride:k,reviewWarningMessage:w,planGroup:b,openInvoiceId:Y,analyticsLocation:t,onSubscriptionConfirmation:H,renderPurchaseConfirmation:W,postSuccessGuild:j,followupSKUInfo:K,referralTrialOfferId:X,skipConfirm:ne,continueSession:nt})})})}function b(n){let{subscriptionTier:e,initialPlanId:t,handleStepChange:i,referralTrialOfferId:r,handleClose:a,continueSession:s}=n,{activeSubscription:E,blockedPayments:p,hasFetchedSubscriptions:m,hasFetchedSubscriptionPlans:T,currencyLoading:M,selectedSkuId:I,setSelectedPlanId:v,defaultPlanId:S,startedPaymentFlowWithPaymentSourcesRef:h}=(0,P.usePaymentContext)(),{isGift:y}=(0,N.wD)(),g=h.current,Z=(0,L.Z)({isGift:y,skuId:I,referralTrialOfferId:r}),{defaultToMonthlyPlan:O}=f.k.getCurrentConfig({location:"055ec5_1"},{autoTrackExposure:!1}),[x,D]=u.useState(!0),G=(0,o.e7)([A.Z],()=>A.Z.applicationIdsFetched.has(U.RQ));return(u.useEffect(()=>{D(!m||!T||M)},[M,T,m]),(0,d.Z)("Payment Modal",x,5,{hasFetchedSubscriptions:m,hasFetchedSubscriptionPlans:T,currencyLoading:M},{tags:{app_context:"billing"}}),u.useEffect(()=>{if(!G&&(0,c.yD)(U.RQ),x||p)return;let n=(0,C.Kp)({isTrial:Z,isGift:y,selectedSkuId:I,startedPaymentFlowWithPaymentSources:g});s?i(R.h8.ADD_PAYMENT_STEPS):null!=t?i(R.h8.REVIEW):n?(v((0,C.nA)(I,E,S)),i(R.h8.REVIEW)):null!=e?i(R.h8.PLAN_SELECT):i(R.h8.SKU_SELECT)},[E,p,G,t,x,i,e,I,v,O,Z,S,y,g,s]),x)?(0,l.jsx)(k.Z,{}):p?(0,l.jsx)(_.Vq,{onClose:a}):null}},928886:function(n,e,t){t.d(e,{U:function(){return h}});var l=t(735250),u=t(470079),i=t(512722),r=t.n(i),a=t(481060),o=t(479446),s=t(646476),c=t(104494),d=t(639119),_=t(981632),E=t(798769),f=t(689011),p=t(669079),m=t(987209),T=t(598),M=t(409813),I=t(981631),A=t(474936),v=t(231338),S=t(983525);function h(n){var e;let{renderHeader:t,referralTrialOfferId:i,handleClose:h}=n,{selectedSkuId:N,step:P,selectedPlan:R,purchaseState:y,purchaseType:g,selectedSku:C}=(0,T.usePaymentContext)(),{isGift:L,selectedGiftStyle:Z,giftRecipient:k}=(0,m.wD)(),O=L&&(0,p.pO)(k)&&P===M.h8.CONFIRM&&null!=Z&&(null==C?void 0:C.productLine)!==I.POd.COLLECTIBLES,x=null!=t&&null!=P,U=P!==M.h8.SKU_SELECT&&null!=N,D=(0,d.N)(i),G=!L&&null!=D&&null!=N&&A.nG[D.trial_id].skus.includes(N),w=(0,c.Ng)(),b=null==w?void 0:null===(e=w.discount)||void 0===e?void 0:e.plan_ids.some(n=>A.GP[n].skuId===N),Y=!L&&null!=w&&null!=N&&b,{enabled:H}=s.ZP.useExperiment({location:"PaymentModalHeader"},{autoTrackExposure:!1}),W=(0,s.rK)(),j=H&&W;return u.useMemo(()=>{if(null==P)return;let n=null;if(O)n=(0,l.jsxs)("div",{className:S.container,children:[(0,l.jsx)(_.Z,{defaultAnimationState:o.S.LOOP,giftStyle:Z,className:S.seasonalGiftBoxHeaderIcon}),(0,l.jsx)(a.ModalCloseButton,{onClick:h,className:S.closeButton})]});else if(x)n=t(null!=R?R:null,h,P);else if(g===v.GZ.ONE_TIME)n=(0,l.jsx)(f.t,{step:P,onClose:h});else if(U)r()(N in A.y7,"invalid sku id: ".concat(N)),n=(0,l.jsx)(E.Z,{currentStep:null!=P?P:void 0,purchaseState:y,premiumType:A.y7[N],onClose:h,showTrialBadge:G,showDiscountBadge:Y,isGift:L,giftRecipient:k,useWinterTheme:j});return n},[Z,h,y,t,R,N,P,G,Y,O,U,x,g,L,k,j])}},456251:function(n,e,t){t.d(e,{Z:function(){return r}});var l=t(735250);t(470079);var u=t(481060),i=t(780324);function r(){return(0,l.jsx)(u.Spinner,{className:i.spinner})}},784707:function(n,e,t){t.d(e,{Z:function(){return u}});var l=t(598);function u(){let{step:n,stepConfigs:e}=(0,l.usePaymentContext)(),t=e.find(e=>e.key===n);return null==t?void 0:t.options}},614223:function(n,e,t){t.d(e,{$g:function(){return r},Kp:function(){return i},nA:function(){return a}});var l=t(74538),u=t(474936);function i(n){let{isTrial:e,isGift:t,selectedSkuId:l,startedPaymentFlowWithPaymentSources:i}=n;return!e&&!t&&null!=l&&u.YQ.includes(l)&&i}function r(n,e,t){let l=!1;return n&&null!=e&&null==e.invoiceItems.find(n=>n.subscriptionPlanId===t.id)&&(l=!0),l}function a(n,e,t){let i=null!=e?(0,l.Af)(e):null,r=u.mn[n],a=null!=t?t:r;return null!=i?a===i.planId&&a===u.IW[n]?a=u.mn[n]:a===i.planId&&a===u.mn[n]?a=u.IW[n]:(i.planId===u.Xh.PREMIUM_YEAR_TIER_0||i.planId===u.Xh.PREMIUM_YEAR_TIER_1)&&a===u.Xh.PREMIUM_MONTH_TIER_2&&(a=u.Xh.PREMIUM_YEAR_TIER_2):a===u.Xh.PREMIUM_YEAR_TIER_1&&(a=u.Xh.PREMIUM_MONTH_TIER_1),a}},48175:function(n,e,t){t.d(e,{T:function(){return i},Z:function(){return r}});var l=t(639119),u=t(474936);function i(n){let{userTrialOffer:e,isGift:t,skuId:l}=n;return!t&&null!=e&&null!=l&&u.nG[e.trial_id].skus.includes(l)}function r(n){let{isGift:e,skuId:t,referralTrialOfferId:i}=n,r=(0,l.N)(i);return!e&&null!=r&&null!=t&&u.nG[r.trial_id].skus.includes(t)}},711007:function(n,e,t){t.d(e,{p:function(){return r}});var l=t(470079),u=t(409813),i=t(882712);function r(n,e,t){l.useEffect(()=>{null!=n&&n!==u.h8.AWAITING_PURCHASE_TOKEN_AUTH&&e===i.I.PENDING?t(u.h8.AWAITING_PURCHASE_TOKEN_AUTH):n===u.h8.AWAITING_PURCHASE_TOKEN_AUTH&&e===i.I.SUCCESS&&t(u.h8.REVIEW)},[n,e,t])}},459965:function(n,e,t){t.d(e,{H:function(){return E},w:function(){return d}});var l=t(470079),u=t(442837),i=t(668781),r=t(509545),a=t(580130),o=t(74538),s=t(231338),c=t(689938);function d(n,e,t){l.useEffect(()=>{null!=n&&n.isPurchasedExternally&&null!=n.paymentGateway&&!t&&(i.Z.show({title:c.Z.Messages.BILLING_EXTERNAL_HEADER.format({paymentGatewayName:s.Vz[n.paymentGateway]}),body:c.Z.Messages.BILLING_EXTERNAL_MANAGE_ELSEWHERE.format({paymentGatewayName:s.Vz[n.paymentGateway],subscriptionManagementLink:(0,o.JE)(n.paymentGateway,"SUBSCRIPTION_MANAGEMENT")}),confirmText:c.Z.Messages.OKAY}),e())},[n])}let _=[];function E(n,e){let t=(0,u.e7)([r.Z],()=>null!=n?r.Z.get(n):null),i=(0,u.e7)([a.Z],()=>{var n;return null!=t&&null!==(n=a.Z.getForSku(t.skuId))&&void 0!==n?n:_}),s=l.useMemo(()=>Array.from(i).filter(n=>{let{parentId:e,consumed:t}=n;return null!=e&&!t}),[i]);return{hasEntitlements:!e&&null!=t&&null!=s&&s.length>=o.ZP.getIntervalMonths(t.interval,t.intervalCount),entitlements:s}}}}]);
//# sourceMappingURL=32776.9f7cbf28fdf182da088e.js.map